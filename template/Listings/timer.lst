C51 COMPILER V9.60.7.0   TIMER                                                             08/24/2023 04:42:22 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE TIMER
OBJECT MODULE PLACED IN .\Objects\timer.obj
COMPILER INVOKED BY: C:\Program Files\Keil_v5\C51\BIN\C51.EXE lib\timer.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PR
                    -INT(.\Listings\timer.lst) OBJECT(.\Objects\timer.obj)

line level    source

   1          #include "timer.h"
   2          #include "defines.h"
   3          #include "utilities.h"
   4          
   5          // 初始化计数器，每次中断时都要调用
   6          void InitTimer0Counter()
   7          {
   8   1          // 设置计数器初始值，只计数1000次，花费1000us=1ms 产生一次中断
   9   1          TL0 = LOW_8_BIT(T1MS);
  10   1          TH0 = HIGH_8_BIT(T1MS);
  11   1      }
  12          
  13          /*
  14              初始化Timer0: 16位定时器/计数器
  15          */
  16          void Timer0Init()
  17          {
  18   1          /*
  19   1              启用Timer0(设置TMOD低4bit)
  20   1              从低到高:
  21   1              Mode位(第0-1位):    01 - 16位定时器/计数器，TL0、TH0全用
  22   1              C/T位(第2位):       0 - 定时器模式，计数器溢出时产生中断
  23   1              Gate位(第3位):      0 - 仅用TR0激活计时器，不用考虑外部输入INT0
  24   1          */
  25   1          // 后4位置 0b0001
  26   1          TMOD &= 0xf0;
  27   1          TMOD |= 0x01;
  28   1          TF0 = 0; // 初始化进位标志，当定时器溢出时该位为1,向CPU发出中断
  29   1      
  30   1          InitTimer0Counter();
  31   1      
  32   1          TR0 = 1; // Gate = 0, TR0 = 1时, 允许T0开始计数
  33   1      
  34   1          // 配置TF0信号路径
  35   1          ET0 = 1; // 允许Timer0产生中断
  36   1          PT0 = 0; // Timer0 产生 低级 中断
  37   1      }
  38          /*
  39              初始化Timer1: 8位定时器自动重装，用作波特率发生器
  40              Timer1被分为两个8位存储器，一个用于保存用于自动重装的数据
  41          */
  42          void Timer1Init()
  43          {
  44   1          /*
  45   1              启用Timer0作为波特率发生器(设置TMOD高4bit)
  46   1              从高到低:
  47   1              Gate: 0 - 仅用TR1激活计时器，不用考虑外部输入INT1
  48   1              C/T: 0 - 定时器模式，溢出就产生信号
  49   1              Mode位: 10 - 工作模式2: 8位定时器自动重装，用作波特率发生器
  50   1          */
  51   1          // 高4位置 0b0010
  52   1          TMOD &= 0x0f;
  53   1          TMOD |= 0x20;
  54   1      
C51 COMPILER V9.60.7.0   TIMER                                                             08/24/2023 04:42:22 PAGE 2   

  55   1          /*
  56   1              定时器初始值计算公式:(中间除以2是因为波特率不加倍)
  57   1                  256-晶振值/12/2/16/波特率
  58   1              这里我们使用: 9600bps@11.0592MHz
  59   1          */
  60   1          TL1 = 0xFD; // 设置定时初始值
  61   1          TH1 = 0xFD; // 设置定时重载值
  62   1      
  63   1          TF1 = 0; // 溢出标志位
  64   1          ET1 = 0; // 不开启Timer1中断
  65   1          TR1 = 1; // Gate = 0, TR1 = 1时, 开始计数
  66   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     44    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
